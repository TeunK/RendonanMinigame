<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_Controller</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>-1</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/***************************************************
  CREATE EVENT
***************************************************/
draw_set_font(font0);

audio_play_sound(snd_bgloop, 10, true);

//start connection when timer reaches 0
connectTimer = 60; 

// TEST_MODE:
t_game = 0; //regular game mode
t_test = 1; //runtime test mode
t_unit = 2; //unit test mode

test_mode               = t_game;
active_testing          = false; //allow popup messages to display with successful test-results
toggle_active_testing   = vk_space; //required key to press to toggle active_testing

if (test_mode==obj_Controller.t_unit)
{
    room_goto(room_Test);
}

//HTTP CONNECTION URL'S
host = "http://localhost";
port = ":8080";
path = "/web/app.php";
load_url    = build_url(host,port,path,"/gameload");
save_url    = build_url(host,port,path,"/gamesave");
score_url   = build_url(host,port,path,"/scoresave");

init_userStats();
/**************************************************/
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/***************************************************
  STEP EVENT
***************************************************/
if (room==room_Game)
{
    atkTimer += calc_incAtkTimer(agility,autoatk);
    
    savetimer += 1;
    savedelay = 300;
    if (savetimer &gt;= savedelay)
    {
        savetimer=0;
        save_game(save_url);
    }
}
/**************************************************/
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="62">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/***************************************************
  HTTP EVENT
***************************************************/
//FETCH USER DATA FROM HTTP REQUEST
if (ds_map_find_value(async_load, "id") == http)
{
    if (ds_map_find_value(async_load, "status") &gt;= 0)
    {
        var user_data
        user_data = ds_map_find_value(async_load, "result"); //user_data = string from received from php file
        user_data = explode_string(user_data,";"); //user_data = array (exploded string resulting from php-string)
        
        //render user_data array into user stat variables
        read_userdata(user_data);
        
        if (room==room_Connect) { room_goto(room_Game) }
    }
}
/**************************************************/
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/***************************************************
  ROOM-START EVENT
***************************************************/
if (room==room_Game)
{
    instance_create(160,384,obj_Player);

    savetimer = 0;
    savedelay = 300;
    
    hpPercent   = calc_percent(currenthp,maxhp);
    autoatk     = false;
    autostr     = "Manual Atk";
    atkTimer    = 5;
    atkLimit    = 45;
    
    btnHP   = instance_create(20,y+20+5*15,obj_Button);
    btnStr  = instance_create(20,y+20+6*15,obj_Button);
    btnAgi  = instance_create(20,y+20+7*15,obj_Button);
    
    monsterSpawnTimer      = 0
    monsterSpawnLimit      = 60;
    monsterSpawnLevel      = 1;
    
    sunflashTimer=0;
    sunflashLimit=1500;
}

if (room==room_Death)
{
    instance_create(room_width/2,room_height/2,obj_Inferno);
}

if (room==room_Test)
{
    instance_create(x,y,obj_TestConnection);
}
/**************************************************/
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/***************************************************
  DRAW EVENT
***************************************************/
if (keyboard_check(vk_control))
{
    draw_crosshair(mouse_x,mouse_y);
}

if (room==room_Connect)
{
    connectTimer -=1;
    if (connectTimer &lt;= 0)
    {
        http = http_get(load_url);
        connectTimer = 600;
    }
    
    test_timer(80,40,connectTimer,0,"Connecting..");
    draw_text_bg(room_width/2,room_height/2,"Attempting to establish connection to server...#Please Wait");
}
else if (room==room_Game)
{
    draw_background(bg_branch,0,0);

    test_toggleActiveMode(toggle_active_testing);

    test_timer(room_width/2, 30, savedelay-savetimer, 0, "Saving Game...");
    
    draw_menu();
    draw_UI(username, xp, coins, currenthp, maxhp, strength, agility);
    
    monster_respawn();
    
    player_death();
    
    level = calc_playerLevel(xp);
    
    //Health Regeneration
    if (currenthp &lt; maxhp)
    { currenthp += 0.0001*maxhp; }
    
    //Limit Health
    if currenthp &gt; maxhp
    { currenthp = maxhp; }
}
else if (room==room_Death)
{
    draw_text_bg(room_width/2,room_height/2,"Oh dear.. You have died.##Your memorial has been passed on to the highscores.#Press &lt;spacebar&gt; to be reborn.");

    //restart game upon spacebar-press
    if keyboard_check_pressed(vk_space)
    {
        game_restart();
    }
}
/**************************************************/
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>0,0</point>
    <point>16,16</point>
  </PhysicsShapePoints>
</object>
